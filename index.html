<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organization Map & Data</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    
    <style>
        body, html { margin: 0; padding: 0; height: 100%; font-family: sans-serif; background: #282c34; color: #abb2bf; }
        
        /* Layout: Map 60%, Tabs+Code 40% */
        #map { 
            height: 60vh; 
            width: 100%; 
            background: #fff;
        }

        #data-section {
            height: 40vh; 
            display: flex;
            flex-direction: column;
            border-top: 4px solid #1e2227;
        }

        /* Tab Header Styling */
        .tabs-header {
            background-color: #21252b;
            display: flex;
            justify-content: space-between; /* Push download button to the right */
            align-items: center;            /* Vertically center items */
            padding: 0 10px;
            border-bottom: 1px solid #181a1f;
        }

        .tab-buttons {
            display: flex;
        }

        .tab-btn {
            background: transparent;
            border: none;
            color: #abb2bf;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn:hover { color: white; background-color: #2c313a; }
        
        .tab-btn.active {
            color: #61afef; /* Blue highlight */
            border-bottom: 2px solid #61afef;
            background-color: #282c34;
        }

        /* Download Button Styling */
        .download-btn {
            text-decoration: none;
            font-size: 0.85rem;
            color: #98c379; /* Green text */
            border: 1px solid #98c379;
            padding: 4px 12px;
            border-radius: 4px;
            transition: all 0.2s;
            font-weight: bold;
            margin-left: 10px;
        }

        .download-btn:hover {
            background-color: #98c379;
            color: #21252b; /* Dark text on green background */
        }

        /* Tab Content Containers */
        .tab-content {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            display: none; 
        }

        .tab-content.active {
            display: block;
        }

        /* JSON View Styling */
        pre {
            margin: 0;
            padding: 15px;
            height: 100%;
            overflow: auto;
            box-sizing: border-box;
        }
        
        code {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
        }

        /* CSV Table Styling */
        #csv-container {
            height: 100%;
            overflow: auto;
            padding: 0;
        }

        table.csv-table {
            border-collapse: collapse;
            width: 100%;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            white-space: nowrap; 
        }

        .csv-table th {
            background-color: #21252b;
            color: #d19a66; 
            position: sticky;
            top: 0;
            text-align: left;
            padding: 8px 12px;
            border-bottom: 2px solid #444;
            border-right: 1px solid #333;
            z-index: 10;
        }

        .csv-table td {
            padding: 6px 12px;
            border-bottom: 1px solid #333;
            border-right: 1px solid #333;
            color: #98c379; 
        }

        .csv-table tr:hover td {
            background-color: #2c313a;
        }
    </style>
</head>
<body>

    <h1>Current OGC members</h1>
    <p>Note: This is not an authoritative OGC member list, please see the <a href="https://www.ogc.org/who-we-are/ogc-member-directory/">OGC Member Directory</a></p>
    <p>Mostly generated by Google Gemini AI, prompted by Ilkka Rinne / Spatineo</p>
    <div id="map"></div>

    <div id="data-section">
        <div class="tabs-header">
            <div class="tab-buttons">
                <button class="tab-btn" onclick="openTab('csv-tab', this)">CSV (Original)</button>
                <button class="tab-btn active" onclick="openTab('geojson-tab', this)">GeoJSON (Generated)</button>
            </div>
            <a href="./OGC_Membership.geojson" download="OGC_Membership.geojson" class="download-btn">
                &#x2193; Download GeoJSON
            </a>
        </div>

        <div id="geojson-tab" class="tab-content active">
            <pre><code id="code-geojson" class="language-json">Loading GeoJSON...</code></pre>
        </div>

        <div id="csv-tab" class="tab-content">
            <div id="csv-container">Loading CSV...</div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>

    <script>
        // --- 1. Map Initialization ---
        var map = L.map('map').setView([20, 0], 2);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        // --- 2. Fetch GeoJSON ---
        fetch('OGC_Membership.geojson')
            .then(res => res.json())
            .then(data => {
                // Add to Map
                var geoJsonLayer = L.geoJSON(data, {
                    onEachFeature: function (feature, layer) {
                        if (feature.properties) {
                            var popup = '<b>Details:</b><br>';
                            for (var k in feature.properties) {
                                var v = feature.properties[k];
                                if(v) popup += `<b>${k}:</b> ${String(v).startsWith('http') ? `<a href="${v}" target="_blank">Link</a>` : v}<br>`;
                            }
                            layer.bindPopup(popup);
                        }
                    }
                }).addTo(map);
                map.fitBounds(geoJsonLayer.getBounds());

                // Update Code View
                const el = document.getElementById('code-geojson');
                el.textContent = JSON.stringify(data, null, 2);
                hljs.highlightElement(el);
            })
            .catch(err => document.getElementById('code-geojson').textContent = "Error: " + err);

        // --- 3. Fetch and Render CSV ---
        fetch('OGC_Membership.csv')
            .then(res => res.text())
            .then(text => {
                const rows = parseCSV(text);
                renderTable(rows);
            })
            .catch(err => document.getElementById('csv-container').textContent = "Error loading CSV.");

        // --- Helper: Parse CSV ---
        function parseCSV(text) {
            const lines = text.split(/\r?\n/).filter(line => line.trim() !== '');
            return lines.map(line => {
                const result = [];
                let current = '';
                let inQuotes = false;
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    if (char === '"') { inQuotes = !inQuotes; }
                    else if (char === ',' && !inQuotes) {
                        result.push(current); current = '';
                    } else { current += char; }
                }
                result.push(current);
                return result.map(val => val.trim().replace(/^"|"$/g, '')); 
            });
        }

        // --- Helper: Render Table ---
        function renderTable(rows) {
            if (rows.length === 0) return;
            let html = '<table class="csv-table">';
            const headers = rows[0];
            html += '<thead><tr>';
            headers.forEach(h => html += `<th>${h}</th>`);
            html += '</tr></thead><tbody>';
            for (let i = 1; i < rows.length; i++) {
                html += '<tr>';
                const row = rows[i];
                headers.forEach((_, index) => {
                    html += `<td>${row[index] || ''}</td>`;
                });
                html += '</tr>';
            }
            html += '</tbody></table>';
            document.getElementById('csv-container').innerHTML = html;
        }

        // --- 4. Tab Logic ---
        function openTab(tabId, btnElement) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            btnElement.classList.add('active');
        }
    </script>
</body>
</html>